---
title: "TP2 - Exercise 4"
author: "Manuela Giansante and Lucia Camenisch"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    toc: true # creating a table of contents (toc)
    toc_float: 
      collapsed: false # toc does not collapse and is shown as a sidebar (toc_float)
    number_sections: true # document sections are numbered
    theme: cosmo
---

```{=html}
<style>
body{
  color: #630000;
  background-color: #FBF1D2;
}
pre{
  background-color: #FFF7ED;
}
pre:not([class]){
  background-color: #EBE7AA;
}
.toc-content{
  padding-left: 10px;
  padding-right: 10px;
}
.col-sm-8 {
  width: 75%;
}
code {
  color: #333333;
  background-color: #FFF7ED;
}
</style>
```
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, fig.align = "center")
```

```{r, warning=FALSE, message=FALSE}
# We load the necessary libraries
library(data.table)
library(ggplot2)
library(kableExtra)
library(dplyr)
```

```{r}
panels <- fread("Case_Stud_ I.csv")

# This dataset contains the following columns:
# Number of Solar Panels
# Manufacturing Costs
```

# PART I

## Use an electronic spreadsheet to plot the data and draw a scatter plot.

```{r}
ggplot(panels, aes(x = number_of_solar_panels, y = manufacturing_cost)) +
  geom_point() +
  xlab("Number of Solar Panels Produced") +
  ylab("Manufactoring Costs")+
  ggtitle("Manufactoring Costs per Units Produced")+
  theme_light()
```

We observe that as the amount of units produced cumulatively increases the costs of manufactoring per unit decline. The gained experience reduces the marginal costs with a constant rate, which is the learning rate.

## Does the multiplicative learning model which assumes the following relationship: $Y = AX^b$ apply to this data set?

The data as plotted out above follows a parabolic shape, the suggested non linear relationship applies.

The one above can be interpreted an experience curve, given that we are considering cumulative production and manufactoring cost per batch of 100 panels produced.

## Make an appropriate transformation of the data and redo the plot with the transformed data.

```{r}
panels_log = log(panels)
head(panels_log) %>% kbl() %>% kable_styling("hover", full_width = F)
```

```{r}
ggplot(panels_log, aes(x = number_of_solar_panels, y = manufacturing_cost)) +
  geom_point() +
  xlab("Log(Number of Solar Panels Produced)") +
  ylab("Log(Manufactoring Costs)")+
  ggtitle("Log-log Plot: Manufactoring Costs per Units Produced")+
  theme_light()
```

By logging the data the relationship $Y=AX^{b}$ becomes $\log(Y)=\log(A)+b\log(X)$, that is now a linear relationship in fact the plotted data no longer follows a parabolic shape. In our case the response variable is the cost and the predictor is the number of produced panels.

# PART II

## Conduct a linear regression with the transformed data.

```{r}
LinReg = lm(manufacturing_cost ~ number_of_solar_panels, data = panels_log)
summary(LinReg)

```

In the context of a linear regression the intercept estimate is the log(A) we mentioned above, and the coefficient of the `number_of_solar_panels` is the b constant preceading log(X).

Both coefficients are significant and the Adjusted R\^2 is quite high, the model does a good job at explaining the variation in the data.

```{r}
plot(LinReg)
```

**Residuals vs Fitted Values plot**

The residuals are scattered around the 0 line suggesting that the relationship between response and predictor is linear.

There is an horizontal band around the 0 line, but the logarithm shifted the cloud of point to the left appearing therefore less uniform.

**Q-Q plot**

The residuals appear normally distributed and they hug the diagonal line without forming any curving shaping which would indicate a violation of the normal distribution and independence assumption regarding errors.

## Interpret the results of the regression analysis. How well does the model explain the data? What is the learning rate that applies in this case?

```{r}
# retrieving the coefficients as computed
beta = LinReg$coefficients
beta %>% kbl(col.names = "Coefficients") %>% kable_styling("hover", full_width = F)
```

```{r}
ggplot(panels_log, aes(x = number_of_solar_panels, y = manufacturing_cost)) +
  geom_point() +
  geom_abline(intercept = beta[1], slope = beta[2], color = "red") +
  xlab("Log(Number of Solar Panels Produced)") +
  ylab("Log(Manufactoring Costs)")+
  ggtitle("Log-log Plot with Fitted Line: Manufactoring Costs per Units Produced")+
  theme_light()
```

As previously seen the Adjusted R\^2 indicated that the fitted model explains 94% of the variations in the manufactoring costs. The fit of the model is satisfying.

We exponentiate the coefficient back to their original form.

```{r}
# Re-trasforming the coefficients
A = as.numeric(exp(beta[1]))
b = as.numeric(beta[2])
# as defined the learning rate is 1-2^b
l = 1-exp(log(2)*b)
```

We refer the article [Experience curve effects - Wikipedia](https://en.wikipedia.org/wiki/Experience_curve_effects) and the Wright's law unit cost curve. The $\tilde{b}$ is the progress ratio which as mentioned in class is 2\^b (slide 10).

$\begin{aligned}\log_2{\tilde{b}}&=b\\\frac{\log(\tilde{b})}{\log(2)}&=b\\e^{\log(\tilde{b})}&=e^{\log(2)*b}\\\tilde{b}&=e^{\log(2)*b}\\$

$1-\tilde{b}&=1-e^{\log(2)*b}\\1-\tilde{b}&=learning\end{aligned}$

```{r}
df<- data.frame(A,b,l)
df%>% kbl() %>% kable_styling("hover", full_width = F)
```

# PART III

## Use the experience curve estimate from the regression model to calculate the expected average manufacturing cost per solar panel for the 400 solar panels that would be produced.

```{r}
# new data
panels_pred =  data.table(number_of_solar_panels = seq(100, 5000, 100))
panels_pred[, manufacturing_cost := A*number_of_solar_panels^b]

```

```{r}
ggplot(panels, aes(x = number_of_solar_panels, y = manufacturing_cost)) +
  geom_point() +
  geom_line(data = panels_pred, aes(x = number_of_solar_panels, y = manufacturing_cost), color = "red") +
  theme_light()
```

```{r}
# average manufacturing cost per solar panel for 4700, 4800, 4900 and 5000:
batch_mean=mean(panels_pred$manufacturing_cost[47:50]) # mean of the batch of 100 
```

# PART IV

## Calculate a 95% confidence interval for the average manufacturing cost per solar panel for the panels produced for Switzerland by using the lower and upper bounds of the confidence interval estimate for the experience parameter.

```{r}
CI = confint(LinReg)
CI
```

```{r}
b_lower = CI[2,1]
b_upper = CI[2,2]
b_lower
b_upper
```

```{r}
panels_pred[, lower := A*number_of_solar_panels^b_lower]
panels_pred[, upper := A*number_of_solar_panels^b_upper]
panels_pred[1:22, 3:4] = NA
```

```{r}
ggplot(panels, aes(x = number_of_solar_panels, y = manufacturing_cost)) +
  geom_point() +
  geom_line(data = panels_pred, aes(x = number_of_solar_panels, y = manufacturing_cost), color = "red") +
  geom_ribbon(data = panels_pred, aes(ymin = lower, ymax = upper), alpha = 0.3, color = NA, fill = "red") +
  theme_light()
```

```{r}
# CI lower bound of average manufacturing cost per solar panel for 4700, 4800, 4900 and 5000:
mean(panels_pred$lower[47:50])

# CI upper bound of average manufacturing cost per solar panel for 4700, 4800, 4900 and 5000:
mean(panels_pred$upper[47:50])
```

## You should calculate two extra regression equations for both limits and then calculate the expected average manufacturing cost per solar panel for the 400 solar panels that would be produced for Switzerland as in exercise 3.

```{r}
batch_mean/100
```
